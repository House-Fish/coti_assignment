# Sample Logstash configuration for creating a simple
# Beats -> Logstash -> Elasticsearch pipeline.

input {
  beats {
    port => 5044
  }
}

filter {
  if [log_type] == "snort" {
    # Parse Snort alert format
    grok {
      match => {
        "message" => '%{MONTHNUM}/%{MONTHDAY}-%{TIME}\s+\[\*\*\]\s+\[%{NUMBER:sid}:%{NUMBER:signature_id}:%{NUMBER:revision}\]\s+%{DATA:alert_message}\s+\[\*\*\]\s+\[Priority:\s+%{NUMBER:priority}\]\s+{%{WORD:protocol}}\s+%{IP:src_ip}:%{NUMBER:src_port}\s+->\s+%{IP:dest_ip}:%{NUMBER:dest_port}'
      }
    }
    
    # Convert timestamp to proper format
    date {
      match => [ "timestamp", "MM/dd-HH:mm:ss.SSSSSS" ]
      target => "@timestamp"
    }
    
    # Convert numeric fields
    mutate {
      convert => {
        "priority" => "integer"
        "sid" => "integer"
        "signature_id" => "integer"
        "revision" => "integer"
        "src_port" => "integer"
        "dest_port" => "integer"
      }
      # Add year since Snort doesn't include it in the timestamp
      add_field => {
        "year" => "2025"  # You might want to update this dynamically
      }
    }

    # Combine date with year for complete timestamp
    mutate {
      replace => {
        "timestamp" => "%{year}/%{message}"
      }
    }
  }
}

output {
  opensearch {
    hosts => ["https://localhost:9200"]
    index => "snort-alerts-%{+YYYY.MM.dd}"
    user => "admin"
    password => "St1ong.Passw0r"
    ssl => true
    ssl_certificate_verification => false
  }
}
